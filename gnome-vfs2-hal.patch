diff -urN aa/gnome-vfs-2.7.4/daemon/Makefile.am gnome-vfs-2.7.4/daemon/Makefile.am
--- aa/gnome-vfs-2.7.4/daemon/Makefile.am	2004-07-14 11:34:42.000000000 +0200
+++ gnome-vfs-2.7.4/daemon/Makefile.am	2004-07-22 13:40:11.537153744 +0200
@@ -2,6 +2,7 @@
 
 INCLUDES= \
 	$(LIBGNOMEVFS_CFLAGS)			\
+	$(LIBGNOMEVFSDAEMON_CFLAGS)				\
 	$(VFS_CFLAGS)				\
 	$(MONIKERS_CFLAGS)                      \
 	-D_FILE_OFFSET_BITS=64			\
diff -urN aa/gnome-vfs-2.7.4/libgnomevfs/gnome-vfs-hal-mounts.c gnome-vfs-2.7.4/libgnomevfs/gnome-vfs-hal-mounts.c
--- aa/gnome-vfs-2.7.4/libgnomevfs/gnome-vfs-hal-mounts.c	2004-07-14 10:13:16.000000000 +0200
+++ gnome-vfs-2.7.4/libgnomevfs/gnome-vfs-hal-mounts.c	2004-07-22 14:37:01.377779176 +0200
@@ -21,10 +21,10 @@
    Author: David Zeuthen <david@fubar.dk>
 */
 
-#ifdef USE_HAL
-
 #include <config.h>
 
+#ifdef USE_HAL
+
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
@@ -876,7 +876,7 @@
 		drive->priv->icon = g_strdup (icon);
 		drive->priv->display_name = _gnome_vfs_volume_monitor_uniquify_drive_name (volume_monitor, name);
 		drive->priv->is_user_visible = computer_visible;
-		drive->priv->volume = NULL;
+		drive->priv->volumes = NULL;
 		drive->priv->hal_udi = g_strdup (udi);
 		
 		_gnome_vfs_volume_monitor_connected (volume_monitor, drive);
@@ -1051,7 +1051,7 @@
 		drive->priv->icon = g_strdup (icon);
 		drive->priv->display_name = _gnome_vfs_volume_monitor_uniquify_drive_name (volume_monitor, name);
 		drive->priv->is_user_visible = computer_visible;
-		drive->priv->volume = NULL;
+		drive->priv->volumes = NULL;
 
 		drive->priv->hal_udi = g_strdup (
 #ifdef HAL_ONLY_SHOW_MOUNTED_VOLUMES
@@ -1119,7 +1119,7 @@
 			vol->priv->hal_udi = g_strdup (udi);
 			
 			vol->priv->drive = drive;
-			_gnome_vfs_drive_set_mounted_volume (drive, vol);
+			_gnome_vfs_drive_add_mounted_volume (drive, vol);
 			
 			_gnome_vfs_volume_monitor_mounted (volume_monitor, vol);			gnome_vfs_volume_unref (vol);
 
